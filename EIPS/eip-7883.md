---
eip: 7883
title: ModExp Gas Cost Increase
description: Increases cost of ModExp precompile
author: Marcin Sobczak (@marcindsobczak), Marek MoraczyÅ„ski (@MarekM25), Marcos Maceo (@stdevMac)
discussions-to: https://ethereum-magicians.org/t/eip-7883-modexp-gas-cost-increase/22841
status: Draft
type: Standards Track
category: Core
created: 2025-02-11
requires: 2565
---

## Abstract

This EIP is modifying the `ModExp` precompile pricing algorithm introduced in [EIP-2565](./eip-2565.md).

## Motivation

Currently the `ModExp` precompile is underpriced in certain scenarios relative to its resource consumption. By adjusting the pricing formula, this EIP aims to address these discrepancies, making `ModExp` sufficiently efficient to enable potential increases in the block gas limit.

## Specification

Upon activation of this EIP, the gas cost of calling the precompile at address `0x0000000000000000000000000000000000000005` will be calculated as follows:

```
def calculate_multiplication_complexity(base_length, modulus_length):
    max_length = max(base_length, modulus_length)
    words = math.ceil(max_length / 8)
    multiplication_complexity = 16
    if max_length > 32: multiplication_complexity = 2 * words**2
    return multiplication_complexity

def calculate_iteration_count(exponent_length, exponent):
    iteration_count = 0
    if exponent_length <= 32 and exponent == 0: iteration_count = 0
    elif exponent_length <= 32: iteration_count = exponent.bit_length() - 1
    elif exponent_length > 32: iteration_count = (16 * (exponent_length - 32)) + ((exponent & (2**256 - 1)).bit_length() - 1)
    return max(iteration_count, 1)

def calculate_gas_cost(base_length, modulus_length, exponent_length, exponent):
    multiplication_complexity = calculate_multiplication_complexity(base_length, modulus_length)
    iteration_count = calculate_iteration_count(exponent_length, exponent)
    return max(500, math.floor(multiplication_complexity * iteration_count))
```

The specific changes from the algorithm defined in [EIP-2565](./eip-2565.md):

### 1. Increased minimal and general price

The gas cost calculation is modified from:

```
    return max(200, math.floor(multiplication_complexity * iteration_count / 3))
```

to:

```
    return max(500, math.floor(multiplication_complexity * iteration_count))
```

This change increases the minimum gas cost from 200 to 500 and triples the general cost by removing the division by 3.

### 2. Increase cost for exponents larger than 32 bytes

The gas cost calculation is modified from:

```
    elif exponent_length > 32: iteration_count = (8 * (exponent_length - 32)) + ((exponent & (2**256 - 1)).bit_length() - 1)
```

to:

```
    elif exponent_length > 32: iteration_count = (16 * (exponent_length - 32)) + ((exponent & (2**256 - 1)).bit_length() - 1)
```

The multiplier for exponents larger than 32 bytes is increased from 8 to 16, doubling its impact.

### 3. Assume the minimal base / modulus length to be 32 and increase the cost when it is larger than 32 bytes

This part of the equation:

```
def calculate_multiplication_complexity(base_length, modulus_length):
    max_length = max(base_length, modulus_length)
    words = math.ceil(max_length / 8)
    return words**2
```

Is replaced by this:

```
def calculate_multiplication_complexity(base_length, modulus_length):
    max_length = max(base_length, modulus_length)
    words = math.ceil(max_length / 8)
    multiplication_complexity = 16
    if max_length > 32: multiplication_complexity = 2 * words**2
    return multiplication_complexity
```

This change introduces a minimal multiplication complexity of 16 and doubles the complexity if the base or modulus length exceeds 32 bytes.

## Rationale

After benchmarking the `ModExp` precompile, we identified certain scenarios that are underpriced and require repricing to ensure appropriate costs. Further research revealed that all underpriced edge cases can be addressed by adjusting the parameters in the current `ModExp` pricing formula. With these changes, the minimum cost for using the `ModExp` precompile will increase from 200 to 500 (a 150% increase), general cost will be tripled (a 200% increase), the minimal base / modulus length will be assumed to be 32 bytes and the cost will scale higher when the `base`, `modulus`, or `exponent` exceed 32 bytes. These adjustments will ensure that the worst-performing edge cases of the `ModExp` precompile in all execution layer clients perform at the level which is no longer a blocker for potential block gas limit increases.

Benchmarking the `ModExp` precompile revealed several scenarios where its gas cost was significantly underestimated. Pricing adjustments are designed to rectify underpriced edge cases by modifying the existing `ModExp` pricing formula parameters. Specifically, the minimum cost for `ModExp` will rise from 200 to 500 (a 150% increase), the general cost will triple (a 200% increase), a minimum base/modulus length of 32 bytes will be assumed and the cost will scale more aggressively when the base, modulus, or exponent exceed 32 bytes. These modifications aim to ensure that the `ModExp` precompile's performance, even in its most resource-intensive edge cases across all execution layer clients, no longer impedes potential increases to the block gas limit.

## Backwards Compatibility

This EIP introduces a backwards-incompatible change. However, similar gas repricings have occurred multiple times in the Ethereum ecosystem, and their effects are well understood.

## Test Cases

No changes are made to the underlying interface or arithmetic algorithms, allowing existing test vectors to be reused. The table below presents the updated gas costs for these test vectors:

| Test Case                    | [EIP-2565](./eip-2565.md) Pricing | EIP-7883 Pricing | Increase |
|------------------------------|-----|-----|----|
| modexp_nagydani_1_square     | 200 | 500 | 150% |
| modexp_nagydani_1_qube       | 200 | 500 | 150% |
| modexp_nagydani_1_pow0x10001 | 341 | 682 | 100% |
| modexp_nagydani_2_square     | 200 | 500 | 150% |
| modexp_nagydani_2_qube       | 200 | 500 | 150% |
| modexp_nagydani_2_pow0x10001 | 1365 | 2730 | 100% |
| modexp_nagydani_3_square     | 341 | 682 | 100% |
| modexp_nagydani_3_qube       | 341 | 682 | 100% |
| modexp_nagydani_3_pow0x10001 | 5461 | 10922 | 100% |
| modexp_nagydani_4_square     | 1365 | 2730 | 100% |
| modexp_nagydani_4_qube       | 1365 | 2730 | 100% |
| modexp_nagydani_4_pow0x10001 | 21845 | 43690 | 100% |
| modexp_nagydani_5_square     | 5461 | 10922 | 100% |
| modexp_nagydani_5_qube       | 5461 | 10922 | 100% |
| modexp_nagydani_5_pow0x10001 | 87381 | 174762 | 100% |
| modexp_marius_1_even         | 2057 | 3774 | 83% |
| modexp_guido_1_even          | 2298 | 4261 | 85% |
| modexp_guido_2_even          | 2300 | 4262 | 85% |
| modexp_guido_3_even          | 5400 | 10800 | 100% |
| modexp_guido_4_even          | 1026 | 1967 | 92% |
| modexp_marcin_1_base_heavy   | 200 | 500 | 150% |
| modexp_marcin_1_exp_heavy    | 215 | 500 | 133% |
| modexp_marcin_1_balanced     | 200 | 500 | 150% |
| modexp_marcin_2_base_heavy   | 867 | 1734 | 100% |
| modexp_marcin_2_exp_heavy    | 852 | 1364 | 60% |
| modexp_marcin_2_balanced     | 996 | 1992 | 100% |
| modexp_marcin_3_base_heavy   | 677 | 677 | 0% |
| modexp_marcin_3_exp_heavy    | 765 | 765 | 0% |
| modexp_marcin_3_balanced     | 1360 | 1360 | 0% |


## Security Considerations

This EIP does not introduce any new functionality or make existing operations cheaper, therefore there are no direct security concerns related to new attack vectors or reduced costs. The primary security consideration for this EIP is the potential for `ModExp` scenarios to be overpriced, though this is deemed a lesser risk compared to the current underpricing issues.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
