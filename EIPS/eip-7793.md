---
eip: 7793
title: ASSERT_TX_INDEX instruction
description: Instruction that only executes at a specific index within a block
author: Marc Harvey-Hill (@Marchhill), Ahmad Bitar (@smartprogrammer93)
discussions-to: https://ethereum-magicians.org/t/eip-7793-txindex-precompile/21513
status: Draft
type: Standards Track
category: Core
created: 2024-10-17
---

## Abstract

This EIP proposes to add a new instruction `ASSERT_TX_INDEX` that reverts if the index of the current transaction within the block does not match the argument provided. This allows for conditional transactions that can only be executed at a certain index within a block.

## Motivation

The new instruction aims to improve support for encrypted mempools. Transactions in an encrypted mempool are ordered while the transactions are encrypted, before being decrypted and included onchain at the top of the block. If the builder does not respect the order when including the decrypted transactions then they could frontrun decrypted transactions. The new instruction can be used to make this impossible; if a decrypted transaction is not included in the correct order it will revert.

It also gives greater support for preconfirmations. *todo*

## Specification

A new instruction `ASSERT_TX_INDEX` shall be created at `TBD`. It takes as an argument the specified transaction index as an offset into calldata.

### Input


### Behaviour

The `ASSERT_TX_INDEX` instruction will revert if the index of the current transaction does not match the argument provided. Additionally, it must be the first instruction executed in a transaction otherwise it will revert. In all other cases the instruction will have no effect.

#### Stack

| Stack      | Value    |
| ---------- | -------- |
| `top - 0`  | `Index`  |

`Index` is a 4 byte uint in big endian encoding. 

### Gas Cost

The gas cost for `ASSERT_TX_INDEX` is a fixed fee of `2`.

## Rationale

### Assertion

An alternative design could simply return the current transaction index. The assertion approach is favoured as it means that the desired transaction index must be determined statically when the transaction is created, rather than allowing dynamic evaluation. This prevents complex constraints being imposed that makes it difficult to build a block.

Furthermore the instruction must be the first one in a transaction and take an argument from calldata, so that one can statically evaluate what the desired transaction index is.

### Gas Price

The instruction is priced to match similar opcodes in the `W_base` set.

## Backwards Compatibility

No backward compatibility issues found.

## Test Cases

N/A

## Security Considerations

None.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
