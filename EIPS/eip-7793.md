---
eip: 7793
title: ASSERTTXINDEX opcode
description: Opcode that only executes at a specific index within a block
author: Marc Harvey-Hill (@Marchhill), Ahmad Bitar (@smartprogrammer93)
discussions-to: https://ethereum-magicians.org/t/eip-7793-asserttxindex-opcode/21513
status: Draft
type: Standards Track
category: Core
created: 2024-10-17
---

## Abstract

This EIP proposes to add a new opcode `ASSERTTXINDEX` that reverts if the index of the current transaction within the block does not match the argument provided. This allows for conditional transactions that can only be executed at a certain index within a block.

## Motivation

The new opcode aims to improve support for encrypted mempools. Transactions in an encrypted mempool are ordered while the transactions are encrypted, before being decrypted and included onchain at the top of the block. If the builder does not respect the order when including the decrypted transactions then they could frontrun decrypted transactions. The new opcode can be used to make this impossible; if a decrypted transaction is not included in the correct order it will revert.

## Specification

If `block.timestamp >= TBD`, a new opcode `ASSERTTXINDEX` shall be created at `TBD`. It takes as an argument the specified transaction index as an offset into calldata.

### Input

Takes as input a 32 byte index into calldata, matching the semantics of `CALLDATALOAD`.

### Behaviour

The `ASSERTTXINDEX` instruction will revert under the following conditions:

- The current transaction index does not match the argument provided.
- If this is not the first instruction executed in the current transaction.
- There is not enough gas remaining or enough items on the stack.

Otherwise it will have no effect.

### Gas Cost

The gas cost for `ASSERTTXINDEX` is a fixed fee of `3`.

## Rationale

### Assertion

An alternative design could simply return the current transaction index. The assertion approach is favoured as it means that the desired transaction index can be determined statically, rather than allowing dynamic behaviour based on the returned transaction index. This prevents complex constraints being imposed that makes it difficult to build a block.

Furthermore the instruction must be the first one in a transaction and take an argument from calldata, so that one can statically evaluate what the desired transaction index is.

### Gas Price

The opcode is priced to match `CALLDATALOAD`, in the `W_verylow` set.

## Backwards Compatibility

No backward compatibility issues found.

## Test Cases

N/A

## Security Considerations

None.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
