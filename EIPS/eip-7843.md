---
eip: 7843
title: SLOTNUM opcode
description: Opcode to get the current slot number
author: Marc Harvey-Hill (@Marchhill)
discussions-to: https://ethereum-magicians.org/t/eip-7843-slot-precompile/22234
status: Draft
type: Standards Track
category: Core
created: 2024-12-06
---

## Abstract

This EIP proposes to add a new opcode that returns the corresponding slot number for the current block.

## Motivation

It is currently possible to calculate the slot number from the block timestamp. However, this requires hardcoding the chain slot length into a smart contract. This would require the contract code to be changed in the event of a future change to slot length. A better approach is for the slot length to be abstracted away from applications, and instead the slot number can be calculated in the consensus layer client and exposed by an opcode.

### Example application: Encrypted Mempools

An example of a smart contract that needs the slot number is a validation contract for an encrypted mempool. In order to be secure, the validity of encrypted mempool transactions should be tied to the inclusion of all transactions by a proposer in the correct slot. This rule can be enforced by a smart contract using this opcode.

## Specification

A new opcode `SLOTNUM` shall be created at `TBD`. It shall return one stack element.

### Output

#### Stack

| Stack      | Value         |
| ---------- | ------------- |
| `top - 0`  | `SlotNumber`  |

`SlotNumber` is an 8 byte uint in big endian encoding.

### Gas Cost

The gas cost for `SLOTNUM` is a fixed fee of `2`.

### RPC changes

The slot number is calculated in the consensus layer and passed to the execution layer through the engine API.

#### Header extension

The header encoding shall be extended to include a `slot_number` field of type `uint64`.

#### PayloadAttributes change

The engine API's `PayloadAttributes` object shall be extended to include a `slot_number` field of type `uint64`.

#### New JSON-RPC endpoints

Consensus layer clients **may** implement the following new RPC endpoints to convert between slot numbers and their corresponding timestamps.

`eth_getSlotNumberFromTimestamp`: `uint64` -> `uint64`
`eth_getTimestampFromSlotNumber`: `uint64` -> `uint64`

## Rationale

### Gas Price

The opcode is priced to match similar opcodes in the `W_base` set.

### Calculation in consensus layer

The slot number could alternatively be calculated in the execution layer using the timestamp, but it is more appropriate to calculate values pertaining to the beacon chain in the consensus layer. Additionally this avoids code duplication, as the slot number is already calculated in the consensus layer.

### ZK-VM proving

The SLOT precompile should not increase the complexity of proving EVM execution, as it is similar to existing opcodes such as TIMESTAMP. The slot number is included in the block header rather than as a `new_payload` parameter, ensuring that the block is self-contained for proving; no extra inputs to the circuit are required.

## Backwards Compatibility

No backward compatibility issues found.

## Test Cases

N/A

## Security Considerations

None.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
